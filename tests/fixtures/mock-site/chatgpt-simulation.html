<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mock ChatGPT Simulation</title>
    <style>
        body { font-family: sans-serif; background-color: #343541; color: #ececf1; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .message-row { display: flex; padding: 20px; border-bottom: 1px solid #2d2d30; }
        .message-row.user { background-color: #343541; }
        .message-row.assistant { background-color: #444654; }
        .avatar { width: 30px; height: 30px; border-radius: 2px; margin-right: 20px; }
        .user .avatar { background-color: #5436da; }
        .assistant .avatar { background-color: #19c37d; }
        .content { line-height: 1.5; white-space: pre-wrap; }
        .input-area { padding: 20px; background-color: #343541; border-top: 1px solid #565869; display: flex; justify-content: center; }
        .input-wrapper { width: 100%; max-width: 768px; position: relative; display: flex; background-color: #40414f; border-radius: 6px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        textarea { width: 100%; max-height: 200px; padding: 10px 40px 10px 10px; background: transparent; border: none; color: white; resize: none; outline: none; font-family: inherit; font-size: 16px; }
        button#send-btn { position: absolute; right: 10px; bottom: 8px; background: transparent; border: none; color: #ececf1; cursor: pointer; padding: 5px; border-radius: 4px; }
        button#send-btn:hover { background-color: #202123; }
        button#send-btn:disabled { color: #5e5e66; cursor: not-allowed; }
        .result-streaming::after { content: 'â–‹'; animation: blink 1s step-end infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    </style>
</head>
<body>
    <div class="chat-container" id="chat-history">
        <!-- Messages will appear here -->
        <div class="message-row assistant">
            <div class="avatar"></div>
            <div class="content">Hello! I am a simulated LLM. How can I help you today?</div>
        </div>
    </div>
    <div class="input-area">
        <div class="input-wrapper">
            <textarea id="prompt-textarea" placeholder="Send a message..." rows="1"></textarea>
            <button id="send-btn">
                <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </div>
    </div>

    <script>
        const textarea = document.getElementById('prompt-textarea');
        const sendBtn = document.getElementById('send-btn');
        const chatHistory = document.getElementById('chat-history');

        const MOCK_RESPONSE_TEXT = "This is a streamed response from the mock server. It simulates how an LLM would generate text token by token. I can also handle multiple lines.\n\nHere is a second paragraph to verify multiline extraction.";

        function createMessage(role, text) {
            const row = document.createElement('div');
            row.className = `message-row ${role}`;
            row.innerHTML = `
                <div class="avatar"></div>
                <div class="content">${text}</div>
            `;
            return row;
        }

        async function streamResponse(element) {
            element.classList.add('result-streaming');
            const tokens = MOCK_RESPONSE_TEXT.split(/(?=\s)/); // Split by words/spaces

            for (const token of tokens) {
                element.textContent += token;
                chatHistory.scrollTop = chatHistory.scrollHeight;
                await new Promise(r => setTimeout(r, 50)); // Simulate delay
            }

            element.classList.remove('result-streaming');
            sendBtn.disabled = false;
        }

        sendBtn.addEventListener('click', () => {
            const text = textarea.value.trim();
            if (!text) return;

            // User message
            chatHistory.appendChild(createMessage('user', text));
            textarea.value = '';
            sendBtn.disabled = true;

            // Assistant message placeholder
            const assistantRow = createMessage('assistant', '');
            const contentDiv = assistantRow.querySelector('.content');
            chatHistory.appendChild(assistantRow);

            // Simulate network delay then stream
            setTimeout(() => streamResponse(contentDiv), 600);
        });

        textarea.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendBtn.click();
            }
        });
    </script>
</body>
</html>
